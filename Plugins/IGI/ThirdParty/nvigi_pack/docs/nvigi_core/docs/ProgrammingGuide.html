<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVIGI - Programming Guide &mdash; In-Game Inferencing SDK 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/pygments_dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme-switcher-general.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/omni-style-dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/api-styles-dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/api-styles.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/mermaid-init.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/theme-setter.js"></script>
        <script src="../../_static/design-tabs.js"></script>
        <script src="../../_static/version.js"></script>
        <script src="../../_static/social-media.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NVIGI - Programming Guide For Local And Cloud Inference" href="ProgrammingGuideAI.html" />
    <link rel="prev" title="GPU Scheduling for AI" href="GpuSchedulingForAI.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="../../index.html">
  <img src="../../_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../NVIGIDeveloperPack.html">NVIDIA In-Game Inferencing (NVIGI) Developer Pack 1.1.0 Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sample/README.html">NVIGI 3D Sample</a></li>
<li class="toctree-l1"><a class="reference internal" href="Architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="GpuSchedulingForAI.html">GPU Scheduling for AI</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NVIGI - Programming Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#version-1-1-0-release">Version 1.1.0 Release</a></li>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introduction">INTRODUCTION</a></li>
<li class="toctree-l2"><a class="reference internal" href="#key-concepts">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#typed-and-versioned-structures">Typed And Versioned Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-data">Input Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-data">Output Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li class="toctree-l2"><a class="reference internal" href="#security">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#digital-signatures">Digital Signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#elevated-privileges">Elevated Privileges</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#core-api">Core API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shutdown">Shutdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interfaces">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#validation">Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#check-if-specific-plugin-is-supported">Check If Specific Plugin Is Supported</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-for-minimum-required-os-version">Check For Minimum Required OS Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-for-minimum-required-adapter-driver-version">Check For Minimum Required Adapter Driver Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-for-minimum-required-adapter-vendor">Check For Minimum Required Adapter Vendor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-for-minimum-required-adapter-architecture">Check For Minimum Required Adapter Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-if-specific-plugin-exports-an-interface">Check If Specific Plugin Exports An Interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nvigi-and-d3d-wrappers-e-g-streamline">NVIGI and D3D Wrappers (e.g. Streamline)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rd-party-dependencies">3rd Party Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#runtime-scenarios-with-dependencies">Runtime Scenarios With Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plugin-and-dependencies-deployment-examples">Plugin And Dependencies Deployment Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#everything-in-one-location">Everything In One Location:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#split-in-multiple-locations">Split In Multiple Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#invalid-configurations">Invalid Configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#collisions-with-the-host">Collisions With The Host</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ProgrammingGuideAI.html">NVIGI - Programming Guide For Local And Cloud Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/README.html">NVIDIA In-Game Inference AI Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideASRWhisper.html">Automatic Speech Recognition (ASR) - Whisper Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideGPT.html">Generative Pre-Trained Transformers (GPT) Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideEmbed.html">Embedding (EMBED) Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source-build/README.html">NVIGI Public Source GitHub Pull-and-Build Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/CustomizingPlugins.html">Creating a Customized Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/3rd-party-licenses.html">3rd PARTY SOFTWARE</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">In-Game Inferencing SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">


<li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
  
<li>NVIGI - Programming Guide</li>

      <li class="wy-breadcrumbs-aside">
      </li>
<li class="wy-breadcrumbs-aside">

  <span>&nbsp;</span>
</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nvigi-programming-guide">
<h1>NVIGI - Programming Guide<a class="headerlink" href="#nvigi-programming-guide" title="Permalink to this headline"></a></h1>
<p>This guide primarily focuses on the general use of the In-Game Inferencing, including how to initialize it and utilize its interfaces.</p>
<blockquote>
<div><p><strong>IMPORTANT</strong>: This guide might contain pseudo code, for the up to date implementation and source code which can be copy pasted please see the <span class="xref myst">basic sample</span></p>
</div></blockquote>
<section id="version-1-1-0-release">
<h2>Version 1.1.0 Release<a class="headerlink" href="#version-1-1-0-release" title="Permalink to this headline"></a></h2>
</section>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction"><span class="std std-doc">Introduction</span></a></p></li>
<li><p><a class="reference internal" href="#key-concepts"><span class="std std-doc">Key Concepts</span></a></p></li>
<li><p><a class="reference internal" href="#typed-and-versioned-structures"><span class="std std-doc">Typed And Versioned Structures</span></a></p></li>
<li><p><a class="reference internal" href="#thread-safety"><span class="std std-doc">Thread Safety</span></a></p></li>
<li><p><a class="reference internal" href="#security"><span class="std std-doc">Security</span></a></p></li>
<li><p><a class="reference internal" href="#core-api"><span class="std std-doc">Core API</span></a></p>
<ul>
<li><p><a class="reference internal" href="#initialization"><span class="std std-doc">Initialization</span></a></p></li>
<li><p><a class="reference internal" href="#shutdown"><span class="std std-doc">Shutdown</span></a></p></li>
<li><p><a class="reference internal" href="#interfaces"><span class="std std-doc">Interfaces</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#validation"><span class="std std-doc">Validation</span></a></p></li>
<li><p><a class="reference internal" href="#rd-party-dependencies"><span class="std std-doc">3rd Party Dependencies</span></a></p></li>
</ul>
</section>
<section id="introduction">
<h2>INTRODUCTION<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h2>
<p>NVIGI functions as a plugin manager that provides <code class="docutils literal notranslate"><span class="pre">secure</span> <span class="pre">plugin</span> <span class="pre">loading</span></code> and an <code class="docutils literal notranslate"><span class="pre">explicit</span></code> API, giving the host application complete control over every aspect of NVIGI’s usage.</p>
</section>
<section id="key-concepts">
<h2>Key Concepts<a class="headerlink" href="#key-concepts" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Typed and version structures are used for all data and C-style interfaces.</p>
<ul>
<li><p>Structures can be chained together as needed</p></li>
<li><p>Structures are ABI and backwards compatible</p></li>
<li><p>Structures can contain C-style API (aka interfaces) or just plain data (aka parameters or properties)</p></li>
</ul>
</li>
<li><p>Each plugin implements at least one C-style interface which is provided to the host application and other plugins to use</p></li>
<li><p>Interfaces are completely custom and it is up to the plugins to decide what functionality is needed in them</p></li>
<li><p>Different plugins can implement identical interfaces if needed, normally they would use different <code class="docutils literal notranslate"><span class="pre">backends</span></code> to provide same functionality</p></li>
<li><p>Plugins are developed independently and can be updated independently (as needed) in any application (even after it has shipped)</p></li>
<li><p>Plugins have unique identifiers in the following namespace format <code class="docutils literal notranslate"><span class="pre">nvigi::plugin::$name{::$backend::$api}::kId</span></code> where backend and API are optional</p></li>
<li><p>The core component <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework</span></code> enumerates all available plugins, determines which plugins can run on user’s system and what interfaces do they export</p>
<ul>
<li><p>Not all plugin locations need to be known when <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework</span></code> is initialized</p></li>
<li><p>However, all shared dependencies must be known and stored in a single location</p></li>
</ul>
</li>
</ul>
</section>
<section id="typed-and-versioned-structures">
<h2>Typed And Versioned Structures<a class="headerlink" href="#typed-and-versioned-structures" title="Permalink to this headline"></a></h2>
<p>Typed and versioned structures can be used to provide input data, obtain output results and call custom C-style APIs.</p>
<section id="input-data">
<h3>Input Data<a class="headerlink" href="#input-data" title="Permalink to this headline"></a></h3>
<p>In this case, the host application provides information to NVIGI. Depending on scenario, multiple inputs (structures) can be chained together and later sought for with the <code class="docutils literal notranslate"><span class="pre">findStruct</span></code> API. Here are some examples:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! We are creating local GPT instance while providing common and D3D12 related information</span>

<span class="c1">//! Common</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">CommonCreationParameters</span><span class="w"> </span><span class="n">common</span><span class="p">{};</span><span class="w"></span>
<span class="n">common</span><span class="p">.</span><span class="n">numThreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myNumCPUThreads</span><span class="p">;</span><span class="w"> </span><span class="c1">// How many CPU threads is instance allowed to use </span>
<span class="n">common</span><span class="p">.</span><span class="n">vramBudgetMB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myVRAMBudget</span><span class="p">;</span><span class="w">  </span><span class="c1">// How much VRAM is instance allowed to occupy</span>
<span class="n">common</span><span class="p">.</span><span class="n">utf8PathToModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myPathToNVIGIModelRepository</span><span class="p">;</span><span class="w"> </span><span class="c1">// Path to provided NVIGI model repository (using UTF-8 encoding)</span>
<span class="n">common</span><span class="p">.</span><span class="n">modelGUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{175C5C5D-E978-41AF-8F11-880D0517C524}&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Model GUID, for details please see NVIGI models repository</span>

<span class="c1">//! GPT specific </span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">GPTCreationParameters</span><span class="w"> </span><span class="n">params</span><span class="p">{};</span><span class="w"></span>
<span class="n">params</span><span class="p">.</span><span class="n">maxNumTokensToPredict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w"></span>
<span class="n">params</span><span class="p">.</span><span class="n">contextSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span><span class="w"></span>
<span class="n">params</span><span class="p">.</span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we are chaining common properties to our main properties like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">chain</span><span class="p">(</span><span class="n">common</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Handle error</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now we provide additional information about D3D12 context, assuming the host application is using D3D graphics API:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! D3D12 specific </span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">D3D12Parameters</span><span class="w"> </span><span class="n">d3d12Params</span><span class="p">{};</span><span class="w"></span>
<span class="n">d3d12Params</span><span class="p">.</span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myDevice</span><span class="p">;</span><span class="w"></span>
<span class="n">d3d12Params</span><span class="p">.</span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myQueue</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Then we chain it together like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">chain</span><span class="p">(</span><span class="n">d3d12Parameters</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Handle error</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Finaly, we end up with the following chained input structure which can be provided to NVIGI inteface(s) for processing:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">nvigi</span><span class="o">::</span><span class="n">GPTCreationParameters</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">D3D12Parameters</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">CommonCreationParameters</span><span class="w"></span>
</pre></div>
</div>
<p>NVIGI plugins, in this case GPT, will use <code class="docutils literal notranslate"><span class="pre">findStruct</span></code> API to find all mandatory and optional inputs which are chained together.</p>
</section>
<section id="output-data">
<h3>Output Data<a class="headerlink" href="#output-data" title="Permalink to this headline"></a></h3>
<p>When calling various NVIGI APIs it is a common case that they provide specific output(s) as typed and versioned structures. Here is one example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Obtain interface, note that interface is just a special typed and version structure</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">IGeneralPurposeTransformer</span><span class="o">*</span><span class="w"> </span><span class="n">igpt</span><span class="p">{};</span><span class="w"></span>
<span class="n">nvigiGetInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">gpt</span><span class="o">::</span><span class="n">ggml</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">igpt</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">.</span><span class="n">nvigiLoadInterface</span><span class="p">);</span><span class="w"></span>

<span class="c1">//! Tell our GPT interface where to find models</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">GPTCreationParameters</span><span class="w"> </span><span class="n">params</span><span class="p">{};</span><span class="w"></span>
<span class="n">common</span><span class="p">.</span><span class="n">utf8PathToModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myPathToModelRepo</span><span class="p">;</span><span class="w"></span>
<span class="c1">//! Chain it together so GPT interface can find it</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">chain</span><span class="p">(</span><span class="n">common</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">//! Now we obtain capabilities and requirements for this instance, again as typed and versioned structure but containing just data</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">CommonCapabilitiesAndRequirements</span><span class="o">*</span><span class="w"> </span><span class="n">caps</span><span class="p">{};</span><span class="w"></span>
<span class="n">getCapsAndRequirements</span><span class="p">(</span><span class="n">igpt</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">caps</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>By design, <strong>NVIGI will chain together any additional output(s)</strong> so the requester can use the <code class="docutils literal notranslate"><span class="pre">findStruct</span></code> function to check if they are present like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Check if optional output is chained with caps</span>
<span class="k">auto</span><span class="w"> </span><span class="n">sampler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findStruct</span><span class="o">&lt;</span><span class="n">nvigi</span><span class="o">::</span><span class="n">GPTSamplerParameters</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">caps</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sampler</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! This interface supports sampler parameters</span>
<span class="w">    </span><span class="c1">//!</span>
<span class="w">    </span><span class="c1">//! They can be modified as needed and chained to the nvigi::GPTCreationParameters when creating an instance</span>
<span class="w">    </span><span class="n">sampler</span><span class="o">-&gt;</span><span class="n">penalizeNewLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">chain</span><span class="p">(</span><span class="n">sampler</span><span class="p">)))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Handle error</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>NOTE: In this example, since interface in question supports <code class="docutils literal notranslate"><span class="pre">nvigi::GPTSamplerParameters</span></code>, sampler parameters can be chained together with the <code class="docutils literal notranslate"><span class="pre">nvigi::GPTCreationParameters</span></code> and serve as input (see the <a class="reference internal" href="#input-data"><span class="std std-doc">above section</span></a>) if it is required to change any sampler related options when creating the instance.</p>
</div></blockquote>
</section>
</section>
<section id="thread-safety">
<h2>Thread Safety<a class="headerlink" href="#thread-safety" title="Permalink to this headline"></a></h2>
<p>By default, any API in NVIGI is NOT thread safe <strong>unless stated otherwise in the comment above the API declaration</strong>. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! ....</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="p">(</span><span class="o">*</span><span class="n">createInstance</span><span class="p">)(</span><span class="k">const</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">NVIGIParameter</span><span class="o">*</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">InferenceInstance</span><span class="o">**</span><span class="w"> </span><span class="n">instance</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Note that the line immediately above the declaration explicitly states that this method is NOT thread safe. It is host’s responsibility to provide synchronization is such scenarios.</p>
</section>
<section id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline"></a></h2>
<section id="digital-signatures">
<h3>Digital Signatures<a class="headerlink" href="#digital-signatures" title="Permalink to this headline"></a></h3>
<p>When running <strong>on Windows and in production configuration</strong>, NVIGI core framework will <strong>enforce digital signature check on all NVIGI plugin libraries but NOT on their dependencies</strong>. For example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>nvigi.plugin.<span class="nv">$name</span>.<span class="nv">$backend</span>.<span class="nv">$api</span>.dll  <span class="c1"># signed by NVDA, signature checked by `nvigi.core.framework.dll`</span>
├── cudaRt_12.dll                     <span class="c1"># signed by NVDA, signature NOT checked by `nvigi.core.framework.dll`</span>
├── tensorRT_10.dll                   <span class="c1"># signed by NVDA, signature NOT checked by `nvigi.core.framework.dll`</span>
├── libprotobuf.dll                   <span class="c1"># not signed, up to the host app to enforce security</span>
├── zlib.dll                          <span class="c1"># not signed, up to the host app to enforce security</span>
└── kernel32.dll                      <span class="c1"># system library, ignored since it is signed by the OS and in the secure location</span>
</pre></div>
</div>
<p>To prevent hackers from replacing <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework.dll</span></code> with potentially malicious code it is expected that the host application uses API located in <code class="docutils literal notranslate"><span class="pre">nvigi_security.h</span></code> to ensure that digital signature is valid before loading any NVIGI libraries. Here is an example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! IMPORTANT: Always use absolute path to DLL</span>
<span class="k">auto</span><span class="w"> </span><span class="n">pathToNVIGICore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">filesystem</span><span class="o">::</span><span class="n">path</span><span class="p">(</span><span class="n">myPathToNVIGISDK</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="sa">L</span><span class="s">&quot;nvigi.core.framework.dll&quot;</span><span class="p">;</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">security</span><span class="o">::</span><span class="n">verifyEmbeddedSignature</span><span class="p">(</span><span class="n">pathToNVIGICore</span><span class="p">.</span><span class="n">wstring</span><span class="p">().</span><span class="n">c_str</span><span class="p">()))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">//! Safe to load core and initialize NVIGI</span>

<span class="w">  </span><span class="c1">//! IMPORTANT: Always use absolute path to DLL</span>
<span class="w">  </span><span class="n">HMODULE</span><span class="w"> </span><span class="n">lib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadLibraryW</span><span class="p">(</span><span class="n">pathToNVIGICore</span><span class="p">.</span><span class="n">wstring</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>IMPORTANT: Failure to check for digital signature on <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework.dll</span></code> can result in executing potentially dangerous code with wide range of consequences.</p>
</div></blockquote>
<p>As mentioned above, <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework.dll</span></code> with NOT check any signatures on 3rd party dependencies. This is a security vulnerability and must be addressed by the host application either by enforcing CRC checks on all DLLs or some other method which ensures that libraries haven’t been tampered with before loading them.</p>
</section>
<section id="elevated-privileges">
<h3>Elevated Privileges<a class="headerlink" href="#elevated-privileges" title="Permalink to this headline"></a></h3>
<p>If the host process is running with elevated privileges <strong>NVIGI core will attempt to downgrade some of them to mitigate security risks</strong>. If this behavior is not desirable it can be overridden by setting <code class="docutils literal notranslate"><span class="pre">PreferenceFlags::eDisablePrivilegeDowngrade</span></code> flag.</p>
<blockquote>
<div><p>IMPORTANT: Please note that <strong>when opting out from the privilege downgrade the host application is taking over the responsibility for any security breaches that might occur</strong> and in this scenario, it is highly recommended to install the NVIGI bits in secure location which can be modified only by admin users.</p>
</div></blockquote>
<p>Here is the list of privileges in question:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SE_LOAD_DRIVER_NAME</span><span class="w"></span>
<span class="n">SE_DEBUG_NAME</span><span class="w"></span>
<span class="n">SE_TCB_NAME</span><span class="w"></span>
<span class="n">SE_ASSIGNPRIMARYTOKEN_NAME</span><span class="w"></span>
<span class="n">SE_SHUTDOWN_NAME</span><span class="w"></span>
<span class="n">SE_BACKUP_NAME</span><span class="w"></span>
<span class="n">SE_RESTORE_NAME</span><span class="w"></span>
<span class="n">SE_TAKE_OWNERSHIP_NAME</span><span class="w"></span>
<span class="n">SE_IMPERSONATE_NAME</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>NOTE: This is related only to Windows platform</p>
</div></blockquote>
</section>
</section>
<section id="core-api">
<h2>Core API<a class="headerlink" href="#core-api" title="Permalink to this headline"></a></h2>
<p>The core API is rather minimalistic and located in the <code class="docutils literal notranslate"><span class="pre">nvigi.h</span></code> header.</p>
<blockquote>
<div><p><strong>VERY IMPORTANT</strong>: Always make sure to securely load <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework.dll</span></code> before calling any NVIGI APIs (see the <a class="reference internal" href="#security"><span class="std std-doc">security section</span></a> above)</p>
</div></blockquote>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Initializes the NVIGI framework</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when your application is initializing</span>
<span class="c1">//!</span>
<span class="c1">//! @param pref Specifies preferred behavior for the NVIGI framework (NVIGI will keep a copy)</span>
<span class="c1">//! @param pluginInfo Optional pointer to data structure containing information about plugins, user system</span>
<span class="c1">//! @param sdkVersion Current SDK version</span>
<span class="c1">//! @returns nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiInit</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Preferences</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginAndSystemInformation</span><span class="o">**</span><span class="w"> </span><span class="n">pluginInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">sdkVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">kSDKVersion</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>This function initializes NVIGI SDK based on the provided preferences. It enumerates available plugins and, if requested, can report back detailed information on what plugins are available, which are compatible with the user’s system and which are not, what are the basic requirements for each plugin etc. Here is an example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">nvigi</span><span class="o">::</span><span class="n">Preferences</span><span class="w"> </span><span class="n">pref</span><span class="p">{};</span><span class="w"></span>
<span class="n">pref</span><span class="p">.</span><span class="n">logLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">LogLevel</span><span class="o">::</span><span class="n">eDefault</span><span class="p">;</span><span class="w"> </span><span class="c1">// eVerbose for more detailed log</span>
<span class="n">pref</span><span class="p">.</span><span class="n">showConsole</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// false when shipping</span>
<span class="n">pref</span><span class="p">.</span><span class="n">numPathsToPlugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">(</span><span class="n">myPathsToNVIGIPlugins</span><span class="p">);</span><span class="w"></span>
<span class="c1">//! NOTE: Plugins and their custom dependencies can be split up across different locations. Shared dependencies must be in one location (see below)</span>
<span class="n">pref</span><span class="p">.</span><span class="n">utf8PathsToPlugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myPathsToNVIGIPlugins</span><span class="p">;</span><span class="w"></span>
<span class="c1">//! NOTE: Location for shared dependencies, if not provided NVIGI will assume that there are NO shared dependencies only custom ones and they are all next to their respective plugins.</span>
<span class="n">pref</span><span class="p">.</span><span class="n">utf8PathToDependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myPathToNVIGISharedPluginDependencies</span><span class="p">;</span><span class="w"></span>
<span class="n">pref</span><span class="p">.</span><span class="n">logMessageCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myCallback</span><span class="p">;</span><span class="w"> </span><span class="c1">// OPTIONAL</span>
<span class="n">pref</span><span class="p">.</span><span class="n">utf8PathToLogsAndData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myPathToLogs</span><span class="p">;</span><span class="w"> </span><span class="c1">// OPTIONAL but highly recommended, much easier to track down any issues</span>

<span class="c1">// Optional info about system and plugins</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">PluginAndSystemInformation</span><span class="o">*</span><span class="w"> </span><span class="n">info</span><span class="p">{};</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigiInit</span><span class="p">(</span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">kSDKVersion</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Note that <strong>not all plugins need to be enumerated here, later on when requesting interfaces it is possible to provide additional paths to search.</strong></p>
<blockquote>
<div><p><strong>IMPORTANT</strong>:
NVIGI SDK can come in various configurations (debug, release, production etc.) which can contain <code class="docutils literal notranslate"><span class="pre">different</span> <span class="pre">3rd</span> <span class="pre">party</span> <span class="pre">dependencies</span></code>. To avoid runtime issues it is absolutely essential to use correct set of NVIGI plugins combined with matching set of 3rd party dependencies - do NOT mix debug, release etc.</p>
</div></blockquote>
</section>
<section id="shutdown">
<h3>Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline"></a></h3>
<p>Once NVIGI is no longer needed the following API needs to be called to release any used resources and unload any plugins which might be resident in memory:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Shuts down the NVIGI module</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when your application is shutting down. </span>
<span class="c1">//!</span>
<span class="c1">//! @returns nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiShutdown</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="interfaces">
<h3>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline"></a></h3>
<p>As mentioned in the introduction, each plugin is assigned a unique identifier and it must implement at least one interface which is represented as a typed and versioned structure. Host application requests an interface which is needed to perform specific tasks and releases it once it is no longer needed. Here is the API which loads an interface:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Loads an interface for a specific NVIGI feature</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when specific interface is needed.</span>
<span class="c1">//!</span>
<span class="c1">//! NOTE: Interfaces are reference counted so they all must be released before underlying plugin is released.</span>
<span class="c1">//!</span>
<span class="c1">//! @param feature Specifies feature which needs to provide the requested interface</span>
<span class="c1">//! @param interfaceType Type of the interface to obtain</span>
<span class="c1">//! @param interfaceVersion Minimal version of the interface to obtain</span>
<span class="c1">//! @param interface Pointer to the interface</span>
<span class="c1">//! @param utf8PathToPlugin Optional path to a new plugin which provides this interface</span>
<span class="c1">//! @returns nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//! </span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiLoadInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">UID</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interfaceType</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">interfaceVersion</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">**</span><span class="w"> </span><span class="n">_interface</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">utf8PathToPlugin</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>It is important to emphasize that this API allows host to provide an additional path to a plugin which implements this interface. In other words, <strong>not all plugin locations need to be known when <code class="docutils literal notranslate"><span class="pre">nvigiInit</span></code> is called</strong>.</p>
<blockquote>
<div><p>NOTE:
This API will load and make resident in memory the shared library which matches the <code class="docutils literal notranslate"><span class="pre">PluginID</span></code> (unless it is already loaded due to earlier request for an interface it implements)</p>
</div></blockquote>
<p><strong>It is highly recommended</strong> to use the templated helpers <code class="docutils literal notranslate"><span class="pre">nvigiGetInterface</span></code> or <code class="docutils literal notranslate"><span class="pre">nvigiGetInterfaceDynamic</span></code> depending on the linking option used in the host application:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Helper method when statically linking NVIGI framework</span>
<span class="c1">//! </span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiGetInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">**</span><span class="w"> </span><span class="n">_interface</span><span class="p">)</span><span class="w"></span>

<span class="c1">//! Helper method when dynamically loading NVIGI framework</span>
<span class="c1">//! </span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="kr">inline</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiGetInterfaceDynamic</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">**</span><span class="w"> </span><span class="n">_interface</span><span class="p">,</span><span class="w"> </span><span class="n">PFun_nvigiLoadInterface</span><span class="o">*</span><span class="w"> </span><span class="n">func</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">nvigi</span><span class="o">::</span><span class="n">IGeneralPurposeTransformer</span><span class="o">*</span><span class="w"> </span><span class="n">igpt</span><span class="p">{};</span><span class="w"></span>

<span class="c1">// Static linking, as an example requesting interface from ggml cuda backend</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigiGetInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">gpt</span><span class="o">::</span><span class="n">ggml</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">igpt</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="p">}</span><span class="w"></span>
<span class="w"> </span>
<span class="c1">// Dynamic `nvigi.core.framework` loading, again as an example requesting interface from ggml cuda backend</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigiGetInterfaceDynamic</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">gpt</span><span class="o">::</span><span class="n">ggml</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">igpt</span><span class="p">,</span><span class="w"> </span><span class="n">nvigiLoadInterfaceFunction</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Handle error</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>When certain interface is no longer needed, it should to be unloaded so that the underlying shared library which implements it can be released. This is achieved with the following API:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Unloads an interface for a specific NVIGI feature</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when specific interface is no longer needed</span>
<span class="c1">//!</span>
<span class="c1">//! @param feature Specifies feature which provided the interface</span>
<span class="c1">//! @param interface Pointer to the interface</span>
<span class="c1">//! @returns IResult interface with code nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiUnloadInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">_interface</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>NOTE:
Interfaces are reference counted so the underlying shared library will be released only when ALL references to the requested interface(s) are released.</p>
</div></blockquote>
</section>
</section>
<section id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline"></a></h2>
<p>Once successfully initialized the optional <code class="docutils literal notranslate"><span class="pre">nvigi::PluginAndSystemInformation</span></code>, if provided as shown in the above section when calling <code class="docutils literal notranslate"><span class="pre">nvigiInit</span></code>, contains useful information which can be used to determine if specific plugin and or interface is available. NVIGI comes with various helpers which can be used as shown below:</p>
<section id="check-if-specific-plugin-is-supported">
<h3>Check If Specific Plugin Is Supported<a class="headerlink" href="#check-if-specific-plugin-is-supported" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api as appropriate</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">getPluginStatus</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the following sections to find out how to detect min spec for OS, drivers etc.</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If plugin in question is not supportedt the following functions can be used to obtain more details:</p>
</section>
<section id="check-for-minimum-required-os-version">
<h3>Check For Minimum Required OS Version<a class="headerlink" href="#check-for-minimum-required-os-version" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api as appropriate</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">Version</span><span class="w"> </span><span class="n">version</span><span class="p">;</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">getPluginRequiredOSVersion</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the version</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="check-for-minimum-required-adapter-driver-version">
<h3>Check For Minimum Required Adapter Driver Version<a class="headerlink" href="#check-for-minimum-required-adapter-driver-version" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api as appropriate</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">Version</span><span class="w"> </span><span class="n">version</span><span class="p">;</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">getPluginRequiredAdapterDriverVersion</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the version</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="check-for-minimum-required-adapter-vendor">
<h3>Check For Minimum Required Adapter Vendor<a class="headerlink" href="#check-for-minimum-required-adapter-vendor" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api as appropriate</span>
<span class="n">nvigi</span><span class="o">::</span><span class="n">VendorId</span><span class="w"> </span><span class="n">vendor</span><span class="p">;</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">getPluginRequiredAdapterVendor</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">vendor</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the vendor</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="check-for-minimum-required-adapter-architecture">
<h3>Check For Minimum Required Adapter Architecture<a class="headerlink" href="#check-for-minimum-required-adapter-architecture" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api as appropriate</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">arch</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0 indicates any architecture is fine</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">getPluginRequiredAdapterArchitecture</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">arch</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the architecture number</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If plugin in question is supported, next we can query if specific interface we are interested in is supported/implemented by the plugin:</p>
</section>
<section id="check-if-specific-plugin-exports-an-interface">
<h3>Check If Specific Plugin Exports An Interface<a class="headerlink" href="#check-if-specific-plugin-exports-an-interface" title="Permalink to this headline"></a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Replace $name::$backend::$api and $some_interface_name as appropriate</span>
<span class="k">if</span><span class="p">(</span><span class="n">NVIGI_FAILED</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">isPluginExportingInterface</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">$name</span><span class="o">::</span><span class="n">$backend</span><span class="o">::</span><span class="n">$api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">$some_interface_name</span><span class="p">)))</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Not supported, check the result</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>IMPORTANT:
At this point NO SHARED LIBRARIES (PLUGINS) ARE LOADED NOR RESIDENT IN MEMORY, only upon an explicit request for an interface implemented by a specific plugin will that plugin be loaded.</p>
</div></blockquote>
</section>
</section>
<section id="nvigi-and-d3d-wrappers-e-g-streamline">
<h2>NVIGI and D3D Wrappers (e.g. Streamline)<a class="headerlink" href="#nvigi-and-d3d-wrappers-e-g-streamline" title="Permalink to this headline"></a></h2>
<p>Care should be taken when integrating NVIGI into an existing application that is also using a D3D object wrapper like Streamline.  The queue/device parameters passed to NVIGI must be the <strong>native</strong> objects, not the app-level wrappers.  In the case of Streamline, this means using <code class="docutils literal notranslate"><span class="pre">slGetNativeInterface</span></code> to retrieve the base interface object before passing it to NVIGI.</p>
</section>
<section id="rd-party-dependencies">
<h2>3rd Party Dependencies<a class="headerlink" href="#rd-party-dependencies" title="Permalink to this headline"></a></h2>
<blockquote>
<div><p><strong>EXTREMELY IMPORTANT PLEASE READ</strong>:
If host application is using the exact same dependency as NVIGI but different version this can lead to runtime issues and random crashes. Please contact NVIDIA do discuss possible solutions.</p>
</div></blockquote>
<p>NVIGI SDK can come in various configurations (debug, release, production) which can contain different 3rd party dependencies.</p>
<p><strong>To avoid runtime issues please make sure that:</strong></p>
<ul class="simple">
<li><p>NVIGI shared dependencies (CUDA, tensorRT etc.) are stored in one location pointed by the <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> parameter.</p></li>
<li><p>Correct set of NVIGI plugins is combined with matching set of 3rd party dependencies (debug and release dependencies are NOT mixed up etc.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathsToPlugins</span></code> and <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> always point to the appropriate locations based on the build configuration.</p></li>
<li><p>On Windows, <code class="docutils literal notranslate"><span class="pre">AddDLLDirectory</span></code> or similar APIs are NOT used to manage NVIGI paths implicitly - <strong>this prevents NVIGI plugins from obtaining the location of their dependencies.</strong></p></li>
<li><p>On Linux, <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> includes path(s) to NVIGI dependencies before host application starts</p></li>
</ul>
<p>In addition to the above, please note the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nvigiInit</span></code> and <code class="docutils literal notranslate"><span class="pre">nvigiLoadInterface</span></code> <strong>are NOT thread safe and they will TEMPORARILY modify DLL search path based on the information provided by the host</strong>.</p>
<ul>
<li><p>Host application should NOT do any DLL related operations while the above mentioned APIs are running without an explicit synchronization</p></li>
</ul>
</li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> is NOT provided <strong>NVIGI will assume that there are NO shared dependencies and any plugin specific dependencies all MUST be next to their respective plugin(s)</strong>.</p></li>
<li><p>Individual plugins might need the <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> to dynamically load their own dependencies and validate digital signatures on them</p></li>
<li><p>If plugin dependency is NOT located in <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathsToPlugins</span></code> or <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> that plugin will fail to load to avoid DLL ABI issues.</p></li>
</ul>
<section id="runtime-scenarios-with-dependencies">
<h3>Runtime Scenarios With Dependencies<a class="headerlink" href="#runtime-scenarios-with-dependencies" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>NVIGI and host application do NOT share any dependencies or share a subset of identical dependencies - same name(s), compatible ABI(s)</p>
<ul>
<li><p>No runtime issues but <strong>keep in mind that NVIGI expects to load its dependencies from <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathsToPlugins</span></code> or <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code></strong></p></li>
</ul>
</li>
<li><p>NVIGI and host application share a subset of dependencies with the same name(s) but incompatible ABI(s)</p>
<ul>
<li><p>Unless each API exported by the dependencies in question is accessed explicitly using <code class="docutils literal notranslate"><span class="pre">HMODULE</span></code> and <code class="docutils literal notranslate"><span class="pre">GetProcAddress</span></code> there can be random crashes and instability</p></li>
<li><p>Preferably, the host application should rename the dependencies in question to avoid ABI collision(s)</p></li>
<li><p>Alternatively, either NVIGI plugin(s) or the host app should be recompiled to use the same version of shared dependencies</p></li>
</ul>
</li>
</ul>
</section>
<section id="plugin-and-dependencies-deployment-examples">
<h3>Plugin And Dependencies Deployment Examples<a class="headerlink" href="#plugin-and-dependencies-deployment-examples" title="Permalink to this headline"></a></h3>
<section id="everything-in-one-location">
<h4>Everything In One Location:<a class="headerlink" href="#everything-in-one-location" title="Permalink to this headline"></a></h4>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>// This is a very common and valid way to distribute NVIGI with your application
$some_path/nvigi
│
├──nvigi.core.framework.dll
├──nvigi.pugin.gpt.ggml.cuda.dll
├──nvigi.pugin.asr.ggml.cuda.dll
├──cudart64_12.dll
├──ggml_40f25557_cuda.dll
└──zlib1.dll
</pre></div>
</div>
<blockquote>
<div><p>NOTE: In this scenario both <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathsToPlugins</span></code> and <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> point to the same location - <code class="docutils literal notranslate"><span class="pre">$some_path/nvigi</span></code></p>
</div></blockquote>
</section>
<section id="split-in-multiple-locations">
<h4>Split In Multiple Locations<a class="headerlink" href="#split-in-multiple-locations" title="Permalink to this headline"></a></h4>
<p>Core and shared dependencies together</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>// Care must be taken not to duplicate plugins or dependencies in this setup
$some_path/nvigi/core
│
├──nvigi.core.framework.dll
└──cudart64_12.dll // Shared by many plugins so must be in one location
</pre></div>
</div>
<blockquote>
<div><p>NOTE: Here <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathToDependencies</span></code> points to <code class="docutils literal notranslate"><span class="pre">$some_path/nvigi/core</span></code> but <code class="docutils literal notranslate"><span class="pre">nvigi::Preferences::utf8PathsToPlugins</span></code> points to different locations (see below)</p>
</div></blockquote>
<p>GPT plugin(s)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>// Care must be taken not to duplicate plugins or dependencies in this setup
$some_path/nvigi/gpt
│
├──nvigi.pugin.gpt.ggml.cuda.dll
└──tensorRT_10.dll // This is OK as long as other plugins don&#39;t use it, this is version 10
</pre></div>
</div>
<p>ASR plugin(s)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>// Care must be taken not to duplicate plugins or dependencies in this setup
$some_path/nvigi/asr
│
├──nvigi.pugin.asr.ggml.cuda.dll
└──tensorRT_11.dll // This is OK as long as other plugins don&#39;t use it, this is version 11
</pre></div>
</div>
<blockquote>
<div><p>NOTE: In the above example, if a new plugin is introduced and uses <code class="docutils literal notranslate"><span class="pre">tensorRT_10.dll</span></code> for example, this shared library now must move to <code class="docutils literal notranslate"><span class="pre">$some_path/nvigi/core</span></code> otherwise we have invalid configuration with duplicated dependency.</p>
</div></blockquote>
</section>
<section id="invalid-configurations">
<h4>Invalid Configurations<a class="headerlink" href="#invalid-configurations" title="Permalink to this headline"></a></h4>
<blockquote>
<div><p>IMPORTANT: Note that in this scenario shared library is duplicated across different locations which is NOT allowed.</p>
</div></blockquote>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$some_path/nvigi/core
│
├──nvigi.core.framework.dll
└──cudart64_12.dll
</pre></div>
</div>
<p>GPT plugin(s)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$some_path/nvigi/gpt
│
├──nvigi.pugin.gpt.ggml.cuda.dll
└──cudart64_12.dll // !!! duplicates NOT allowed
</pre></div>
</div>
<p>ASR plugin(s)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$some_path/nvigi/asr
│
├──nvigi.pugin.asr.ggml.cuda.dll
└──cudart64_12.dll // !!! duplicates NOT allowed
</pre></div>
</div>
</section>
<section id="collisions-with-the-host">
<h4>Collisions With The Host<a class="headerlink" href="#collisions-with-the-host" title="Permalink to this headline"></a></h4>
<p>In this example, host uses <code class="docutils literal notranslate"><span class="pre">AddDllDirectory</span></code> to include <code class="docutils literal notranslate"><span class="pre">$some_path/my_app_dependencies</span></code> in the OS search path or loads <code class="docutils literal notranslate"><span class="pre">libz.dll</span></code> prior to initializing NVIGI which then results in NVIGI using incorrect <code class="docutils literal notranslate"><span class="pre">libz.dll</span></code> which can lead to instability or incorrect runtime behavior.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$some_path/nvigi/core
│
├──nvigi.core.framework.dll
├──cudart64_12.dll
└──libz.dll // !!! NVIGI version
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>$some_path/my_app_dependencies
│
└──libz.dll // !!! HOST version
</pre></div>
</div>
<blockquote>
<div><p>NOTE: If similar issue occurs while deploying your application please contact NVIDIA</p>
</div></blockquote>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
<img src="../../_static/NVIDIA-LogoBlack.svg" class="only-light"/>
<img src="../../_static/NVIDIA-LogoWhite.svg" class="only-dark"/>

<p class="notices">
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/" target="_blank">Privacy Policy</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/" target="_blank">Manage My Privacy</a>
|
<a href="https://www.nvidia.com/en-us/preferences/start/" target="_blank">Do Not Sell or Share My Data</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/" target="_blank">Terms of Service</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/accessibility/" target="_blank">Accessibility</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/company-policies/" target="_blank">Corporate Policies</a>
|
<a href="https://www.nvidia.com/en-us/product-security/" target="_blank">Product Security</a>
|
<a href="https://www.nvidia.com/en-us/contact/" target="_blank">Contact</a>
</p>

<p>
  Copyright &#169; 2024-2025, NVIDIA Corporation.
</p>

    <p>
      <span class="lastupdated">Last updated on Mar 13, 2025.
      </span></p>

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
 



</body>
</html>