<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture &mdash; In-Game Inferencing SDK 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/pygments_dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme-switcher-general.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/omni-style-dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/api-styles-dark.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/omni-style.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/api-styles.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/mermaid-init.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/theme-setter.js"></script>
        <script src="../../_static/design-tabs.js"></script>
        <script src="../../_static/version.js"></script>
        <script src="../../_static/social-media.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="GPU Scheduling for AI" href="GpuSchedulingForAI.html" />
    <link rel="prev" title="NVIGI 3D Sample" href="../../sample/README.html" />
 


</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >


<a href="../../index.html">
  <img src="../../_static/nvidia-logo-white.png" class="logo" alt="Logo"/>
</a>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../NVIGIDeveloperPack.html">NVIDIA In-Game Inferencing (NVIGI) Developer Pack 1.1.0 Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sample/README.html">NVIGI 3D Sample</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#typed-and-versioned-structures">Typed And Versioned Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#interfaces">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#core">Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="#internal-api">Internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plugin-structure">Plugin Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#external-api">External API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-loading">Interface loading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-unloading">Interface unloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shutdown">Shutdown</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GpuSchedulingForAI.html">GPU Scheduling for AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProgrammingGuide.html">NVIGI - Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="ProgrammingGuideAI.html">NVIGI - Programming Guide For Local And Cloud Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/README.html">NVIDIA In-Game Inference AI Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideASRWhisper.html">Automatic Speech Recognition (ASR) - Whisper Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideGPT.html">Generative Pre-Trained Transformers (GPT) Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/ProgrammingGuideEmbed.html">Embedding (EMBED) Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source-build/README.html">NVIGI Public Source GitHub Pull-and-Build Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/docs/CustomizingPlugins.html">Creating a Customized Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins/sdk/3rd-party-licenses.html">3rd PARTY SOFTWARE</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">In-Game Inferencing SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">


<li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
  
<li>Architecture</li>

      <li class="wy-breadcrumbs-aside">
      </li>
<li class="wy-breadcrumbs-aside">

  <span>&nbsp;</span>
</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline"></a></h1>
<p>NVIGI stands for NVIDIA In-Game Inferencing. It is a plugin manager that provides a simple way to obtain <strong>typed and versioned</strong> C style interfaces which can implement range of arbitrary algorithms and features.</p>
<p>Here are some key points about NVIGI:</p>
<ul class="simple">
<li><p>flexible and backwards compatible external and internal <strong>explicit</strong> API</p></li>
<li><p>allows independent plugin development and deployment</p></li>
<li><p>mix and match of different plugins from different SDK is totally fine</p></li>
<li><p>each plugin can implement one or more interfaces as needed</p></li>
</ul>
<section id="typed-and-versioned-structures">
<h2>Typed And Versioned Structures<a class="headerlink" href="#typed-and-versioned-structures" title="Permalink to this headline"></a></h2>
<p>Each structure is assigned a GUID to represent its type and predefined constant <code class="docutils literal notranslate"><span class="pre">kStructVersionN</span></code> to represent its version as shown in this code snippet:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Inference instance </span>
<span class="c1">//! </span>
<span class="c1">//! {AD9DC29C-0A89-4A4E-B900-A7183B48336E}</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">InferenceInstance</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NVIGI_UID</span><span class="p">(</span><span class="n">UID</span><span class="p">({</span><span class="w"> </span><span class="mh">0xad9dc29c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4a4e</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0xb9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">kStructVersion1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">...</span><span class="w">       </span>
<span class="p">}</span><span class="w"></span>
<span class="c1">// Performs static asserts to ensure given structure is C ABI compatible</span>
<span class="n">NVIGI_VALIDATE_STRUCT</span><span class="p">(</span><span class="n">InferenceInstance</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Once shipped, structures cannot be modified other than appending new members <strong>at the end and increasing the version</strong>. Structures can be used as C style interfaces or simple data containers as needed.</p>
<blockquote>
<div><p>IMPORTANT:
When creating new structures always use the <span class="xref myst">provided utility executable</span></p>
</div></blockquote>
<section id="interfaces">
<h3>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline"></a></h3>
<p>Typed and versioned structures which contain <strong>a backwards compatible C style API</strong> are called <code class="docutils literal notranslate"><span class="pre">interfaces</span></code>. Here is an example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Inference instance </span>
<span class="c1">//! </span>
<span class="c1">//! Contains in/out signatures and the inference execution method</span>
<span class="c1">//! </span>
<span class="c1">// {AD9DC29C-0A89-4A4E-B900-A7183B48336E}</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">InferenceInstance</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NVIGI_UID</span><span class="p">(</span><span class="n">UID</span><span class="p">({</span><span class="w"> </span><span class="mh">0xad9dc29c</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa89</span><span class="p">,</span><span class="w"> </span><span class="mh">0x4a4e</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0xb9</span><span class="p">,</span><span class="w"> </span><span class="mh">0x0</span><span class="p">,</span><span class="w"> </span><span class="mh">0xa7</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3b</span><span class="p">,</span><span class="w"> </span><span class="mh">0x48</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x6e</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="n">kStructVersion1</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Instance data, must be passed as input to all functions below</span>
<span class="w">    </span><span class="n">InferenceInstanceData</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Returns feature Id e.g. LLM, ASR etc.</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getFeatureId</span><span class="p">)(</span><span class="n">InferenceInstanceData</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Returns an array of descriptors for the input data expected by this instance</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">InferenceDataDescriptorArray</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getInputSignature</span><span class="p">)(</span><span class="n">InferenceInstanceData</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Returns an array of descriptors for the output data provided by this instance</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">InferenceDataDescriptorArray</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">getOutputSignature</span><span class="p">)(</span><span class="n">InferenceInstanceData</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Evaluates provided execution context</span>
<span class="w">    </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="p">(</span><span class="o">*</span><span class="n">evaluate</span><span class="p">)(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">InferenceExecutionContext</span><span class="o">*</span><span class="w"> </span><span class="n">execCtx</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! NEW MEMBERS GO HERE, BUMP THE VERSION!</span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="core">
<h2>Core<a class="headerlink" href="#core" title="Permalink to this headline"></a></h2>
<p>The NVIGI core component <code class="docutils literal notranslate"><span class="pre">nvigi.core.framework</span></code> scans directories specified by the host for any NVIGI plugins, enumerates them and maps the plugin feature ids with the interfaces they implement. Plugin manager
ensures that plugins are digitally signed, supported on the system and that correct API version is used so we don’t end up loading a plugin with the newer API.</p>
<blockquote>
<div><p>IMPORTANT:
A plugin is started <strong>only</strong> upon a specific request for an interface implemented by the plugin in question. Request is made by the host app or another plugin.</p>
</div></blockquote>
</section>
<section id="internal-api">
<h2>Internal API<a class="headerlink" href="#internal-api" title="Permalink to this headline"></a></h2>
<p>Each plugin implements a rather simple API. Here are the core methods:</p>
<p>Exported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nvigiPluginGetFunction</span></code></p></li>
</ul>
<p>Not exported but rather fetched via <code class="docutils literal notranslate"><span class="pre">nvigiPluginGetFunction</span></code>:</p>
<p>Core API</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nvigiPluginGetInfo</span></code> - provides information about the plugin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvigiPluginRegister</span></code> - registers interface(s) with the framework</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nvigiPluginDeregister</span></code> - de-registers interface(s) and performs cleanup</p></li>
</ul>
<blockquote>
<div><p>IMPORTANT:
<code class="docutils literal notranslate"><span class="pre">nvigiPlugin{De}Register</span></code> should NOT contain any <code class="docutils literal notranslate"><span class="pre">heavy</span> <span class="pre">lifting</span></code> in terms of memory allocations or any complex actions. <strong>Exported interfaces should handle all that</strong>.</p>
</div></blockquote>
</section>
<section id="versioning">
<h2>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline"></a></h2>
<p>We track two versions:</p>
<ul class="simple">
<li><p>Plugin version</p></li>
<li><p>API version</p></li>
</ul>
<p>API version is increased if plugin exports new methods through <code class="docutils literal notranslate"><span class="pre">nvigiPluginGetFunction</span></code> or if the core API is modified in any way. For any other changes we increase the plugin version.</p>
</section>
<section id="plugin-structure">
<h2>Plugin Structure<a class="headerlink" href="#plugin-structure" title="Permalink to this headline"></a></h2>
<p>First we need to define our global context containing data we need during the plugin’s lifecycle, here is an example from the template plugin:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span><span class="w"> </span><span class="nn">nvigi</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">tmpl</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>

<span class="c1">//! Our common context</span>
<span class="c1">//! </span>
<span class="c1">//! Here we can keep whatever global state we need</span>
<span class="c1">//! </span>
<span class="k">struct</span><span class="w"> </span><span class="nc">TemplateContext</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">NVIGI_PLUGIN_CONTEXT_CREATE_DESTROY</span><span class="p">(</span><span class="n">TemplateContext</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Called when plugin is loaded, do any custom constructor initialization here</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreateContext</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">//! For example</span>
<span class="w">        </span><span class="c1">//!</span>
<span class="w">        </span><span class="c1">//! onHeap = new std::map&lt;...&gt;</span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Called when plugin is unloaded, destroy any objects on heap here</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">onDestroyContext</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">//! For example</span>
<span class="w">        </span><span class="c1">//!</span>
<span class="w">        </span><span class="c1">//! delete onHeap;</span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>

<span class="w">    </span><span class="c1">// For example, interface we will export</span>
<span class="w">    </span><span class="n">ITemplate</span><span class="w"> </span><span class="n">api</span><span class="p">{};</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="p">}</span><span class="w"> </span><span class="c1">// namespace tmpl</span>
</pre></div>
</div>
<p>Now we define our plugin by specifying the name, version, API version and our context:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Define our plugin, make sure to update version numbers in versions.h</span>
<span class="n">NVIGI_PLUGIN_DEFINE</span><span class="p">(</span><span class="s">&quot;nvigi.plugin.template&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="p">(</span><span class="n">VERSION_MAJOR</span><span class="p">,</span><span class="w"> </span><span class="n">VERSION_MINOR</span><span class="p">,</span><span class="w"> </span><span class="n">VERSION_PATCH</span><span class="p">),</span><span class="w"> </span><span class="n">Version</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">tmpl</span><span class="p">,</span><span class="w"> </span><span class="n">TemplateContext</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p><strong>NOTE:</strong>
All plugin names must be in <code class="docutils literal notranslate"><span class="pre">nvigi.plugin.$name.$backend{.$api}</span></code> format and generated modules must follow the same naming convention. See existing plugins for examples.</p>
</div></blockquote>
<p>Next we specify core function which provides information about our plugin:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Main entry point - get information about our plugin</span>
<span class="c1">//! </span>
<span class="n">Result</span><span class="w"> </span><span class="nf">nvigiPluginGetInfo</span><span class="p">(</span><span class="n">framework</span><span class="o">::</span><span class="n">IFramework</span><span class="o">*</span><span class="w"> </span><span class="n">framework</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">PluginInfo</span><span class="o">**</span><span class="w"> </span><span class="n">_info</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">plugin</span><span class="o">::</span><span class="n">internalPluginSetup</span><span class="p">(</span><span class="n">framework</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">kResultInvalidState</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Internal API, we know that incoming pointer is always valid</span>
<span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plugin</span><span class="o">::</span><span class="n">getContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">info</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">info</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Essential information, plugin id, API and implementation versions</span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">tmpl</span><span class="o">::</span><span class="n">backend</span><span class="o">::</span><span class="n">api</span><span class="o">::</span><span class="n">kId</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">//! Provide additional information about the plugin</span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;my plugin for doing some awesome stuff&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">author</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NVIDIA&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">build</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GIT_BRANCH_AND_LAST_COMMIT</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">interfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">plugin</span><span class="o">::</span><span class="n">getInterfaceInfo</span><span class="o">&lt;</span><span class="n">ITemplate</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// List GUIDs for interface(s) this plugin is going to export</span>

<span class="w">    </span><span class="c1">//! Specify minimum spec for the OS, driver and GPU architecture</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! Defaults indicate no restrictions - plugin can run on any system, even without any adapter</span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">requiredVendor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">VendorId</span><span class="o">::</span><span class="n">eNone</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">minDriver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">minOS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="w">    </span><span class="n">info</span><span class="p">.</span><span class="n">minGPUArch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">kResultOk</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The following methods are required for the API v0.0.1 but please note that <code class="docutils literal notranslate"><span class="pre">they</span> <span class="pre">are</span> <span class="pre">NOT</span> <span class="pre">exported</span> <span class="pre">directly</span></code> but rather fetched via <code class="docutils literal notranslate"><span class="pre">nvigiPluginGetFunction</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Main entry point - starting our plugin</span>
<span class="c1">//! </span>
<span class="n">Result</span><span class="w"> </span><span class="nf">nvigiPluginRegister</span><span class="p">(</span><span class="n">framework</span><span class="o">::</span><span class="n">IFramework</span><span class="o">*</span><span class="w"> </span><span class="n">framework</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! IMPORTANT: </span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! NO HEAVY LIFTING (MEMORY ALLOCATIONS, GPU RESOURCE CREATION ETC) IN THIS METHOD </span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! JUST PROVIDE INFORMATION REQUESTED AS QUICKLY AS POSSIBLE</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">plugin</span><span class="o">::</span><span class="n">internalPluginSetup</span><span class="p">(</span><span class="n">framework</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">kResultInvalidState</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">tmpl</span><span class="o">::</span><span class="n">getContext</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Add your interface(s) to the framework</span>
<span class="w">    </span><span class="c1">//!</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">createInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmpl</span><span class="o">::</span><span class="n">createInstance</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">destroyInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmpl</span><span class="o">::</span><span class="n">destroyInstance</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ctx</span><span class="p">.</span><span class="n">api</span><span class="p">.</span><span class="n">getCapsAndRequirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmpl</span><span class="o">::</span><span class="n">getCapsAndRequirements</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">framework</span><span class="o">-&gt;</span><span class="n">addInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">tmpl</span><span class="o">::</span><span class="n">backend</span><span class="o">::</span><span class="n">api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ctx</span><span class="p">.</span><span class="n">api</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Obtain interfaces from other plugins or core (if needed)</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! For example, here we use our internal helper function to obtain networking interface</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! NOTE: This will trigger loading of the &#39;nvigi.net&#39; plugin if it wasn&#39;t loaded already</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="n">net</span><span class="o">::</span><span class="n">INet</span><span class="o">*</span><span class="w"> </span><span class="n">net</span><span class="p">{};</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">getInterface</span><span class="p">(</span><span class="n">framework</span><span class="p">,</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">net</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">NVIGI_LOG_ERROR</span><span class="p">(</span><span class="s">&quot;Failed to obtain interface&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">//! IMPORTANT: Check version before accessing v2+ members</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">kStructVersion2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// OK to access v2 members</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">kStructVersion3</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// OK to access v3 members</span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">//! Do any other startup tasks here</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! IMPORTANT: </span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! NO HEAVY LIFTING WHEN REGISTERING PLUGINS</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! Use your interface(s) to create instance(s) or context(s)</span>
<span class="w">    </span><span class="c1">//! then do all initialization, memory allocations etc. within</span>
<span class="w">    </span><span class="c1">//! the API which is exposed with your interface(s).</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">kResultOk</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">//! Main exit point - shutting down our plugin</span>
<span class="c1">//! </span>
<span class="n">Result</span><span class="w"> </span><span class="nf">nvigiPluginDeregister</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">tmpl</span><span class="o">::</span><span class="n">getContext</span><span class="p">());</span><span class="w"></span>

<span class="w">    </span><span class="c1">//! Remove your interface(s) from the framework</span>
<span class="w">    </span><span class="c1">//!</span>
<span class="w">    </span><span class="n">plugin</span><span class="o">::</span><span class="n">getContext</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">framework</span><span class="o">-&gt;</span><span class="n">removeInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">plugin</span><span class="o">::</span><span class="n">tmpl</span><span class="o">::</span><span class="n">backend</span><span class="o">::</span><span class="n">api</span><span class="o">::</span><span class="n">kId</span><span class="p">,</span><span class="w"> </span><span class="n">ITemplate</span><span class="o">::</span><span class="n">s_type</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="c1">//! Do any other shutdown tasks here</span>
<span class="w">    </span><span class="c1">//!</span>
<span class="w">    </span><span class="c1">//! IMPORTANT: </span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! NO HEAVY LIFTING WHEN DE-REGISTERING PLUGINS</span>
<span class="w">    </span><span class="c1">//! </span>
<span class="w">    </span><span class="c1">//! Use your interface(s) to destroy instance(s) or context(s)</span>
<span class="w">    </span><span class="c1">//! then do all de-initialization, memory de-allocations etc. within</span>
<span class="w">    </span><span class="c1">//! the API which is exposed with your interface(s)., *</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">kResultOk</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Finally we export a single function <code class="docutils literal notranslate"><span class="pre">nvigiPluginGetFunction</span></code> which is responsible for fetching the rest of the API:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! The only exported function - gateway to all functionality</span>
<span class="n">NVIGI_EXPORT</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">nvigiPluginGetFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">functionName</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">//! Core API</span>
<span class="w">    </span><span class="n">NVIGI_EXPORT_FUNCTION</span><span class="p">(</span><span class="n">nvigiPluginGetInfo</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">NVIGI_EXPORT_FUNCTION</span><span class="p">(</span><span class="n">nvigiPluginRegister</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">NVIGI_EXPORT_FUNCTION</span><span class="p">(</span><span class="n">nvigiPluginDeregister</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="external-api">
<h2>External API<a class="headerlink" href="#external-api" title="Permalink to this headline"></a></h2>
<p>When it comes to the external API, NVIGI follows a simple concept of loading and unloading typed and versioned C style interfaces based on the requests coming from the host application. Here are the details:</p>
<section id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline"></a></h3>
<p>NVIGI framework is initialized with the following API:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Initializes the NVIGI framework</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when your application is initializing</span>
<span class="c1">//!</span>
<span class="c1">//! @param pref Specifies preferred behavior for the NVIGI framework (NVIGI will keep a copy)</span>
<span class="c1">//! @param sdkVersion Current SDK version</span>
<span class="c1">//! @returns IResult interface with code nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiInit</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Preferences</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pref</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">sdkVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">kSDKVersion</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>IMPORTANT:
After calling nvigiInit <strong>no plugins are started</strong> - they are simply enumerated and ready to provide interfaces on demand.</p>
</div></blockquote>
</section>
<section id="interface-loading">
<h3>Interface loading<a class="headerlink" href="#interface-loading" title="Permalink to this headline"></a></h3>
<p>When a specific interface is needed the following API can be used to obtain it:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Loads an interface for a specific NVIGI feature</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when specific interface is needed.</span>
<span class="c1">//!</span>
<span class="c1">//! NOTE: Interfaces are reference counted so they all must be released before underlying plugin is released.</span>
<span class="c1">//!</span>
<span class="c1">//! @param feature Specifies feature which needs to provide the requested interface</span>
<span class="c1">//! @param interfaceType Type of the interface to obtain</span>
<span class="c1">//! @param interfaceVersion Minimal version of the interface to obtain</span>
<span class="c1">//! @param interface Pointer to the interface</span>
<span class="c1">//! @param utf8PathToPlugin Optional path to a new plugin which provides this interface</span>
<span class="c1">//! @returns nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! NOTE: It is recommended to use the template based helpers `nvigiGetInterface` or `nvigiGetInterfaceDynamic` (see below in this header)</span>
<span class="c1">//! </span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiLoadInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">PluginID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">UID</span><span class="o">&amp;</span><span class="w"> </span><span class="n">interfaceType</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">interfaceVersion</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">**</span><span class="w"> </span><span class="n">_interface</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">utf8PathToPlugin</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>IMPORTANT: This API allows new plugins to be loaded and registered <strong>after</strong> <code class="docutils literal notranslate"><span class="pre">nvigiInit</span></code> has been called</p>
</div></blockquote>
</section>
<section id="interface-unloading">
<h3>Interface unloading<a class="headerlink" href="#interface-unloading" title="Permalink to this headline"></a></h3>
<p>When a specific interface is no longer needed the following API can be used to unload it and free all resources associated with it:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Unloads an interface for a specific NVIGI feature</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when specific interface is no longer needed</span>
<span class="c1">//!</span>
<span class="c1">//! @param feature Specifies feature which provided the interface</span>
<span class="c1">//! @param interface Pointer to the interface</span>
<span class="c1">//! @returns IResult interface with code nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiUnloadInterface</span><span class="p">(</span><span class="n">nvigi</span><span class="o">::</span><span class="n">UID</span><span class="w"> </span><span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">_interface</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<blockquote>
<div><p>NOTE:
If the unloaded interface was the last interface implemented by a plugin, the plugin in question will be unloaded and shutdown sequence for it will be triggered.</p>
</div></blockquote>
</section>
<section id="shutdown">
<h3>Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline"></a></h3>
<p>When NVIGI is no longer needed the following API will unload any existing interfaces and destroy the framework:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//! Shuts down the NVIGI module</span>
<span class="c1">//!</span>
<span class="c1">//! Call this method when your application is shutting down. </span>
<span class="c1">//!</span>
<span class="c1">//! @returns IResult interface with code nvigi::kResultOk if successful, error code otherwise (see nvigi_result.h for details)</span>
<span class="c1">//!</span>
<span class="c1">//! This method is NOT thread safe.</span>
<span class="n">NVIGI_API</span><span class="w"> </span><span class="n">nvigi</span><span class="o">::</span><span class="n">Result</span><span class="w"> </span><span class="n">nvigiShutdown</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
<img src="../../_static/NVIDIA-LogoBlack.svg" class="only-light"/>
<img src="../../_static/NVIDIA-LogoWhite.svg" class="only-dark"/>

<p class="notices">
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-policy/" target="_blank">Privacy Policy</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/privacy-center/" target="_blank">Manage My Privacy</a>
|
<a href="https://www.nvidia.com/en-us/preferences/start/" target="_blank">Do Not Sell or Share My Data</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/terms-of-service/" target="_blank">Terms of Service</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/accessibility/" target="_blank">Accessibility</a>
|
<a href="https://www.nvidia.com/en-us/about-nvidia/company-policies/" target="_blank">Corporate Policies</a>
|
<a href="https://www.nvidia.com/en-us/product-security/" target="_blank">Product Security</a>
|
<a href="https://www.nvidia.com/en-us/contact/" target="_blank">Contact</a>
</p>

<p>
  Copyright &#169; 2024-2025, NVIDIA Corporation.
</p>

    <p>
      <span class="lastupdated">Last updated on Mar 13, 2025.
      </span></p>

  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>
 



</body>
</html>